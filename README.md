# Скрипт для резервного копирования на внешний HDD с LUKS шифрованием

### Требования
- rsync
- python3

### Описание
Работает на сервере через crontab, запускается каждые 2 минуты и проверяет подключенение диска и наличие lock файла.
1. Диск подключенен, lock файл не существует
    - Если накопитель смонитрован, запускает процесс резервного копирования
    - Если накопитель не смонитрован, монтирует диск и запускает процесс резервного копирования
2. Диск подключенен, lock файл существует
    Завершение скрипта
3. Диск отключен, lock файл существует
    Удаление lock файла и завершение скрипта

В процессе резервного копирования производится проверка на наличие конечной папки, при отсутствии она создается. После завершения работы скрипта в чат будет отправлено уведомление о завершении.

Копирование и работа с luks производится с помощью системных вызовов.

### Описание conf файла
Скрипт ищет файл с конфигом по пути `/etc/usb-backup/settings.conf`, создаем папку, помещаем туда конфиг, выставляем права (600).
- `LUKS_PSW = qwerty123` - Пароль для расшифровки диска
- `DEV_ID = /dev/disk/by-id/usb-SEAGATE_1234567890-part1` - используется id диска, потому что `sdX` может смениться
- `MOUNTDIR = /mnt/backups` - директория куда будем бэкапить
- `LUKS_NAME = EncryptVol` - имя LUKS тома
- `TG_BOT_TOKEN = 123:abc` - токен telegram бота
- `TG_CHAT_ID = 1234567890` - ID чата куда будем слать уведомления
- `LOCK_FILE = /tmp/usb-backup.lock` - расположение lock файла
- `SRC_DIR = /src/dir` - директория откуда будем бэкапить
- `LOG_FILE = /var/log/bck-usb.log` - разположение файла с логами
